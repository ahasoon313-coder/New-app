<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My Shifts</title>
<meta name="apple-mobile-web-app-title" content="My Shifts">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#f2f2f7">

<link rel="apple-touch-icon" href="icon-v2.png">

<style>
:root {
  --bg: #f2f2f7; --card: #ffffff; --text: #000000; 
  --header-bg: #f2f2f7; --border: #e5e5ea;
  --primary: #007AFF; --highlight: #ff9500;
  --font-stack: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
}
body.dark {
  --bg: #000000; --card: #1c1c1e; --text: #ffffff; 
  --header-bg: #000000; --border: #38383a;
}

body {
  margin: 0; padding: 12px;
  font-family: var(--font-stack);
  background: var(--bg); color: var(--text);
  transition: background 0.3s ease;
  padding-bottom: 40px; /* Space for bottom scroll */
}

/* --- Controls Grid --- */
.controls-area {
  display: grid; grid-template-columns: 1fr auto auto; gap: 8px;
  margin-bottom: 12px;
}
.row-btn {
  display: flex; gap: 8px;
}

select, button {
  padding: 10px 14px; border-radius: 10px; font-size: 15px; border: none;
  font-weight: 600; cursor: pointer;
  background: var(--card); color: var(--text);
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}
button:active { transform: scale(0.96); }
.btn-primary { background: var(--primary); color: white; }
.btn-icon { padding: 10px; min-width: 44px; }

/* --- Navigation --- */
.month-nav {
  display: flex; align-items: center; justify-content: space-between;
  background: var(--card); padding: 6px; border-radius: 12px;
  margin-bottom: 16px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}
.month-nav h2 { margin: 0; font-size: 18px; font-weight: 700; }

/* --- Calendar Structure --- */
.calendar-wrapper {
  background: var(--card); border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.08);
  overflow: hidden; /* Contains the scroll */
  border: 1px solid var(--border);
}

.header, .row {
  display: grid; 
  /* Default: Date + 5 Groups */
  grid-template-columns: 80px repeat(5, 1fr); 
  text-align: center; align-items: stretch;
}

/* FOCUS MODE: When a specific group is active, hide others */
.calendar-wrapper[data-mode="focus"] .header,
.calendar-wrapper[data-mode="focus"] .row {
  grid-template-columns: 90px 1fr; /* Date + Selected Group */
}

/* Hide unselected cells in focus mode */
.calendar-wrapper[data-mode="focus"] .col-hidden { display: none; }

.header {
  background: var(--header-bg); 
  position: sticky; top: 0; z-index: 10;
  border-bottom: 1px solid var(--border);
  font-size: 13px; color: var(--text); opacity: 0.8;
}
.header div { padding: 12px 0; font-weight: 800; }

.row { border-bottom: 1px solid var(--border); }
.row:last-child { border-bottom: none; }

/* --- Date Cell --- */
.date-cell {
  display: flex; flex-direction: column; justify-content: center; align-items: center;
  font-weight: 700; font-size: 16px;
  padding: 8px 4px;
  background: var(--card); /* Keeps sticky bg opaque */
  border-right: 1px solid var(--border);
}
.day-name { font-size: 11px; opacity: 0.5; font-weight: 500; text-transform: uppercase; margin-top: 2px;}

/* Holiday Tag */
.holiday-tag {
  font-size: 9px; padding: 2px 4px; border-radius: 4px;
  margin-top: 4px; white-space: nowrap; overflow: hidden; max-width: 100%;
  background: #ff3b30; color: white; display: none;
}
.holiday .holiday-tag { display: block; }
.ramadan .holiday-tag { display: block; background: #34c759; }

/* --- Shift Cells --- */
.shift-cell {
  display: flex; justify-content: center; align-items: center;
  font-weight: 600; font-size: 14px; padding: 10px 0;
}
.calendar-wrapper[data-mode="focus"] .shift-cell {
  font-size: 18px; /* Bigger text in focus mode */
  font-weight: 700;
}

/* Colors */
.M { background: #ffe599; color: #5b4812; }
.A { background: #9fc5e8; color: #1e3f5e; }
.N { background: #7c6eb0; color: white; }
.O { background: transparent; color: var(--text); opacity: 0.3; }

body.dark .M { background: #665c3d; color: #fff; }
body.dark .A { background: #3a4e63; color: #fff; }
body.dark .N { background: #5a4f85; color: #fff; }

/* Markers */
.today-row .date-cell { color: var(--primary); }
.today-row { position: relative; }
.today-row::after {
  content: ""; position: absolute; left: 0; top: 0; bottom: 0; width: 4px;
  background: var(--primary);
}

</style>
</head>

<body>

<div class="controls-area">
  <select id="groupSelect" onchange="updateGroup()">
    <option value="-1">All Groups</option>
    <option value="0">Group A</option>
    <option value="1">Group B</option>
    <option value="2">Group C</option>
    <option value="3">Group D</option>
    <option value="4">Group E</option>
  </select>
  
  <div class="row-btn">
    <button onclick="copyLink()" class="btn-icon">üîó</button>
    <button onclick="toggleLang()" class="btn-icon">üåê</button>
    <button onclick="toggleDark()" class="btn-icon">üåô</button>
  </div>
</div>

<div class="month-nav">
  <button class="btn-icon" onclick="changeMonth(-1)">‚óÄ</button>
  <div style="text-align:center; cursor:pointer" onclick="resetToToday()">
    <h2 id="monthTitle">January 2026</h2>
    <span id="jumpTodayText" style="font-size:11px; color:var(--primary); opacity:0.8">Jump to Today</span>
  </div>
  <button class="btn-icon" onclick="changeMonth(1)">‚ñ∂</button>
</div>

<div class="calendar-wrapper" id="calendarWrapper">
  <div class="header" id="calHeader"></div>
  <div id="calendarBody"></div>
</div>

<script>
/* ---------- DATA CONFIGURATION ---------- */
const shiftCodes = ["M", "A", "N", "O", "O"];
const shiftNames = {
  en: { M: "Morning", A: "Afternoon", N: "Night", O: "Off" },
  ar: { M: "ÿµÿ®ÿßÿ≠", A: "ÿπÿµÿ±", N: "ŸÑŸäŸÑ", O: "ÿ±ÿßÿ≠ÿ©" }
};
const days = {
  en: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
  ar: ["ÿ£ÿ≠ÿØ", "ÿ•ÿ´ŸÜŸäŸÜ", "ÿ´ŸÑÿßÿ´ÿßÿ°", "ÿ£ÿ±ÿ®ÿπÿßÿ°", "ÿÆŸÖŸäÿ≥", "ÿ¨ŸÖÿπÿ©", "ÿ≥ÿ®ÿ™"]
};

// Reference: 15 Jan 2026 => A=Morning
const referenceDate = new Date(2026, 0, 15);

// Holidays (Key=YYYY-MM-DD)
const islamicEvents = {
  "2026-02-18": { type: "ramadan", en: "Ramadan", ar: "ÿ±ŸÖÿ∂ÿßŸÜ" },
  "2026-03-20": { type: "holiday", en: "Eid Al-Fitr", ar: "ÿπŸäÿØ ÿßŸÑŸÅÿ∑ÿ±" },
  "2026-05-26": { type: "holiday", en: "Arafah", ar: "ÿπÿ±ŸÅÿ©" },
  "2026-05-27": { type: "holiday", en: "Eid Al-Adha", ar: "ÿπŸäÿØ ÿßŸÑÿ£ÿ∂ÿ≠Ÿâ" }
};

/* ---------- STATE ---------- */
let currentDate = new Date();
let lang = localStorage.getItem("lang") || "en";
let isDark = localStorage.getItem("dark") === "true";
let selectedGroup = parseInt(localStorage.getItem("group") || "-1");

/* ---------- INITIALIZATION ---------- */
const params = new URLSearchParams(window.location.search);
if (params.get("group")) {
  const map = { A: 0, B: 1, C: 2, D: 3, E: 4 };
  let gParam = params.get("group").toUpperCase();
  if (map[gParam] !== undefined) selectedGroup = map[gParam];
}

// Apply Initial State
groupSelect.value = selectedGroup;
if (isDark) document.body.classList.add("dark");
render();

/* ---------- LOGIC ---------- */
function updateGroup() {
  selectedGroup = parseInt(groupSelect.value);
  localStorage.setItem("group", selectedGroup);
  render();
}

function toggleLang() {
  lang = lang === "en" ? "ar" : "en";
  localStorage.setItem("lang", lang);
  render();
}

function toggleDark() {
  isDark = !isDark;
  localStorage.setItem("dark", isDark);
  document.body.classList.toggle("dark");
}

function changeMonth(n) {
  currentDate.setMonth(currentDate.getMonth() + n);
  render();
}

function resetToToday() {
  currentDate = new Date();
  render();
}

function copyLink() {
  const groups = ["A","B","C","D","E"];
  let url = window.location.href.split('?')[0];
  if (selectedGroup !== -1) {
    url += `?group=${groups[selectedGroup]}`;
  }
  navigator.clipboard.writeText(url).then(() => alert("Link copied!"));
}

/* ---------- RENDER ENGINE ---------- */
function render() {
  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();
  
  // UI Text
  monthTitle.innerText = currentDate.toLocaleString(lang, { month: "long", year: "numeric" });
  jumpTodayText.innerText = lang === "ar" ? "ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸäŸàŸÖ" : "Jump to Today";
  
  // Setup Wrapper Mode (Focus vs All)
  const wrapper = document.getElementById("calendarWrapper");
  if (selectedGroup !== -1) {
    wrapper.setAttribute("data-mode", "focus");
  } else {
    wrapper.removeAttribute("data-mode");
  }

  // Build Header
  const groups = ["A", "B", "C", "D", "E"];
  let headerHTML = `<div>${lang==="ar"?"ÿ™ÿßÿ±ŸäÿÆ":"Date"}</div>`;
  
  groups.forEach((g, index) => {
    let hideClass = (selectedGroup !== -1 && selectedGroup !== index) ? "col-hidden" : "";
    headerHTML += `<div class="${hideClass}">${g}</div>`;
  });
  document.getElementById("calHeader").innerHTML = headerHTML;

  // Build Body
  const calBody = document.getElementById("calendarBody");
  calBody.innerHTML = "";
  
  const today = new Date(); today.setHours(0,0,0,0);
  const daysInMonth = new Date(year, month + 1, 0).getDate();

  for (let d = 1; d <= daysInMonth; d++) {
    const dateObj = new Date(year, month, d);
    dateObj.setHours(0,0,0,0);
    const isoDate = dateObj.toISOString().split("T")[0];
    
    // Check Holiday
    let eventData = islamicEvents[isoDate];
    // Simple logic for Ramadan range (hardcoded range check for demo)
    // In production, better to have a function that checks ranges
    if(!eventData && isoDate >= "2026-02-18" && isoDate <= "2026-03-19") {
       eventData = { type: "ramadan", en: "Ramadan", ar: "ÿ±ŸÖÿ∂ÿßŸÜ" };
    }

    const row = document.createElement("div");
    row.className = "row";
    if (dateObj.getTime() === today.getTime()) row.classList.add("today-row");
    if (eventData) row.classList.add(eventData.type);

    // Date Column
    let eventLabel = "";
    if (eventData) {
      eventLabel = `<div class="holiday-tag">${eventData[lang]}</div>`;
    }
    
    row.innerHTML = `
      <div class="date-cell">
        <span>${d}</span>
        <span class="day-name">${days[lang][dateObj.getDay()]}</span>
        ${eventLabel}
      </div>
    `;

    // Shift Columns
    const diff = Math.floor((dateObj - referenceDate) / 86400000);
    
    for (let g = 0; g < 5; g++) {
      // Logic for Focus Mode: Skip rendering if we are in focus mode and this isn't the group
      let hideClass = (selectedGroup !== -1 && selectedGroup !== g) ? "col-hidden" : "";
      
      const idx = (diff + g + 5) % 5; 
      // Handle negative modulo in JS
      const shiftIndex = ((idx % 5) + 5) % 5;
      
      const code = shiftCodes[shiftIndex];
      const shiftName = shiftNames[lang][code];

      const cell = document.createElement("div");
      cell.className = `shift-cell ${code} ${hideClass}`;
      cell.innerText = shiftName;
      
      row.appendChild(cell);
    }
    calBody.appendChild(row);
  }
}
</script>
</body>
</html>
