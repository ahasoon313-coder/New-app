<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My Shifts</title>
<meta name="apple-mobile-web-app-title" content="My Shifts">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
<meta name="apple-mobile-web-app-capable" content="yes">

<meta name="theme-color" content="#f2f2f7" id="meta-theme-color">

<link rel="apple-touch-icon" href="icon-v2.png">
<link rel="icon" type="image/png" href="icon-v2.png">

<style>
:root {
  --bg: #f2f2f7; --card: #ffffff; --text: #000000;
  --header-bg: #f2f2f7; --border: #e5e5ea;
  --primary: #007AFF; --highlight: #ff9500;
  --font-stack: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, sans-serif;
}
body.dark {
  --bg: #000000; --card: #1c1c1e; --text: #ffffff;
  --header-bg: #000000; --border: #38383a;
}

body {
  margin: 0; padding: 12px;
  font-family: var(--font-stack);
  background: var(--bg); color: var(--text);
  padding-bottom: 40px; /* Space for scroll */
  transition: background 0.3s ease;
}

/* --- Controls --- */
.controls-area {
  display: grid; grid-template-columns: 1fr auto auto; gap: 8px;
  margin-bottom: 12px;
}
.row-btn { display: flex; gap: 8px; }

select, button {
  padding: 10px 14px; border-radius: 10px; font-size: 15px; border: none;
  font-weight: 600; cursor: pointer;
  background: var(--card); color: var(--text);
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}
button:active { transform: scale(0.96); }
.btn-icon { padding: 10px; min-width: 44px; }

/* --- Navigation --- */
.month-nav {
  display: flex; align-items: center; justify-content: space-between;
  background: var(--card); padding: 6px; border-radius: 12px;
  margin-bottom: 16px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.05);
}
.month-nav h2 { margin: 0; font-size: 17px; font-weight: 700; }
.jump-hint { font-size: 10px; color: var(--primary); display: block; margin-top: 2px; }

/* --- Calendar Wrapper --- */
.calendar-wrapper {
  background: var(--card); border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.08);
  overflow: hidden; border: 1px solid var(--border);
}

.header, .row {
  display: grid;
  /* Default 5 columns */
  grid-template-columns: 70px repeat(5, 1fr);
  text-align: center; align-items: stretch;
}

/* FOCUS MODE: When a group is selected, we change grid to 2 columns */
.calendar-wrapper.focus-mode .header,
.calendar-wrapper.focus-mode .row {
  grid-template-columns: 85px 1fr;
}

.header {
  background: var(--header-bg); position: sticky; top: 0; z-index: 10;
  border-bottom: 1px solid var(--border);
  font-size: 13px; font-weight: 800; opacity: 0.9;
  backdrop-filter: blur(5px);
}
.header div { padding: 12px 0; }

.row { border-bottom: 1px solid var(--border); }

/* --- Date Cell --- */
.date-cell {
  display: flex; flex-direction: column; justify-content: center; align-items: center;
  font-weight: 700; font-size: 15px; padding: 6px 2px;
  background: var(--card); border-right: 1px solid var(--border);
}
.day-name { font-size: 10px; opacity: 0.5; font-weight: 500; text-transform: uppercase; }

/* Holiday Tag Styling */
.holiday-tag {
  font-size: 9px; padding: 2px 4px; border-radius: 4px;
  margin-top: 3px; white-space: nowrap; overflow: hidden; max-width: 100%;
  color: white; font-weight: normal;
}
.ramadan-tag { background: #34c759; }
.eid-tag { background: #ff3b30; }

/* --- Shift Cells --- */
.shift-cell {
  display: flex; justify-content: center; align-items: center;
  font-weight: 600; font-size: 14px; padding: 10px 0;
}
/* Bigger text when focused */
.calendar-wrapper.focus-mode .shift-cell { font-size: 18px; font-weight: 700; }

/* Hiding columns logic */
.col-hidden { display: none; }

/* Colors */
.M { background: #ffe599; color: #5b4812; }
.A { background: #9fc5e8; color: #1e3f5e; }
.N { background: #8e7cc3; color: white; }
.O { background: transparent; color: var(--text); opacity: 0.3; }

body.dark .M { background: #665c3d; color: #fff; }
body.dark .A { background: #3a4e63; color: #fff; }
body.dark .N { background: #5a4f85; color: #fff; }

/* Markers */
.today-row .date-cell { color: var(--primary); }
.today-row { position: relative; }
.today-row::after {
  content: ""; position: absolute; left: 0; top: 0; bottom: 0; width: 4px;
  background: var(--primary);
}
</style>
</head>

<body>

<div class="controls-area">
  <select id="groupSelect" onchange="saveGroup()">
    <option value="-1">All Groups</option>
    <option value="0">Group A</option>
    <option value="1">Group B</option>
    <option value="2">Group C</option>
    <option value="3">Group D</option>
    <option value="4">Group E</option>
  </select>
  
  <div class="row-btn">
    <button onclick="shareLink()" class="btn-icon">üîó</button>
    <button onclick="toggleLang()" class="btn-icon">üåê</button>
    <button onclick="toggleDark()" class="btn-icon">üåô</button>
  </div>
</div>

<div class="month-nav">
  <button class="btn-icon" onclick="changeMonth(-1)">‚óÄ</button>
  <div style="text-align:center; cursor:pointer" onclick="resetToToday()">
    <h2 id="monthTitle"></h2>
    <span class="jump-hint" id="jumpText">Jump to Today</span>
  </div>
  <button class="btn-icon" onclick="changeMonth(1)">‚ñ∂</button>
</div>

<div class="calendar-wrapper" id="calendarWrapper">
  <div class="header" id="calHeader"></div>
  <div id="calendarBody"></div>
</div>

<script>
/* ---------- DATA ---------- */
const shiftCodes = ["M", "A", "N", "O", "O"];
const shiftNames = {
  en: { M: "Morning", A: "Afternoon", N: "Night", O: "Off" },
  ar: { M: "ÿµÿ®ÿßÿ≠", A: "ÿπÿµÿ±", N: "ŸÑŸäŸÑ", O: "ÿ±ÿßÿ≠ÿ©" }
};
const days = {
  en: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
  ar: ["ÿ£ÿ≠ÿØ", "ÿ•ÿ´ŸÜŸäŸÜ", "ÿ´ŸÑÿßÿ´ÿßÿ°", "ÿ£ÿ±ÿ®ÿπÿßÿ°", "ÿÆŸÖŸäÿ≥", "ÿ¨ŸÖÿπÿ©", "ÿ≥ÿ®ÿ™"]
};

// Reference: 15 Jan 2026 => A=M
const referenceDate = new Date(2026, 0, 15);

// Kuwait Islamic Dates Data
const islamicEvents = {
  2026: {
    ramadanStart: "2026-02-18",
    ramadanEnd: "2026-03-19",
    eidFitr: "2026-03-20",
    arafah: "2026-05-26",
    eidAdha: "2026-05-27"
  }
};

/* ---------- STATE ---------- */
let currentDate = new Date();
let lang = localStorage.getItem("lang") || "en";
let dark = localStorage.getItem("dark") === "true";

/* ---------- URL & GROUP HANDLING ---------- */
const params = new URLSearchParams(window.location.search);
const linkGroup = params.get("group");

if (linkGroup) {
  const map = { A: 0, B: 1, C: 2, D: 3, E: 4 };
  if (map[linkGroup.toUpperCase()] !== undefined) {
    localStorage.setItem("group", map[linkGroup.toUpperCase()]);
  }
}

const savedGroup = localStorage.getItem("group") ?? "-1";
groupSelect.value = savedGroup;

// Lock selector only if link provided
if (linkGroup) groupSelect.disabled = true;

/* ---------- FUNCTIONS ---------- */

// NEW: Helper to update Safari top bar color
function updateThemeColor(isDark) {
  const themeMeta = document.getElementById("meta-theme-color");
  if (themeMeta) {
    // #000000 for Dark, #f2f2f7 for Light
    themeMeta.setAttribute("content", isDark ? "#000000" : "#f2f2f7");
  }
}

function saveGroup() {
  localStorage.setItem("group", groupSelect.value);
  render();
}

function toggleLang() {
  lang = lang === "en" ? "ar" : "en";
  localStorage.setItem("lang", lang);
  render();
}

function toggleDark() {
  dark = !dark;
  localStorage.setItem("dark", dark);
  document.body.classList.toggle("dark");
  updateThemeColor(dark); // Update top bar when button clicked
}

function changeMonth(n) {
  currentDate.setMonth(currentDate.getMonth() + n);
  render();
}
function resetToToday() {
  currentDate = new Date();
  render();
}

function shareLink() {
  const gVal = parseInt(groupSelect.value);
  const groups = ["A","B","C","D","E"];
  let url = window.location.href.split('?')[0];
  if (gVal !== -1) {
    url += `?group=${groups[gVal]}`;
  }
  navigator.clipboard.writeText(url).then(() => {
    alert(lang === "ar" ? "ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿßŸÑÿ±ÿßÿ®ÿ∑!" : "Link copied!");
  });
}

/* ---------- RENDER ENGINE ---------- */
function render() {
  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();
  const selected = parseInt(groupSelect.value);
  const wrapper = document.getElementById("calendarWrapper");

  // UI Text
  monthTitle.innerText = currentDate.toLocaleString(lang, { month: "long", year: "numeric" });
  document.getElementById("jumpText").innerText = lang === "ar" ? "ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸäŸàŸÖ" : "Jump to Today";

  // Focus Mode Toggle (CSS Class)
  if (selected !== -1) wrapper.classList.add("focus-mode");
  else wrapper.classList.remove("focus-mode");

  // Build Header
  const groups = ["A", "B", "C", "D", "E"];
  let headerHTML = `<div>${lang==="ar"?"ÿ™ÿßÿ±ŸäÿÆ":"Date"}</div>`;
  groups.forEach((g, idx) => {
    // Hide column if we are in focus mode and this isn't the selected group
    const hidden = (selected !== -1 && selected !== idx) ? "col-hidden" : "";
    headerHTML += `<div class="${hidden}">${g}</div>`;
  });
  document.getElementById("calHeader").innerHTML = headerHTML;

  // Build Body
  const calBody = document.getElementById("calendarBody");
  calBody.innerHTML = "";
  
  const today = new Date(); today.setHours(0,0,0,0);
  const daysInMonth = new Date(year, month + 1, 0).getDate();
  const events = islamicEvents[year];

  for (let d = 1; d <= daysInMonth; d++) {
    const date = new Date(year, month, d);
    date.setHours(0,0,0,0);
    const iso = date.toISOString().split("T")[0];

    // Determine Holiday Name
    let holidayName = "";
    let holidayClass = "";

    if (events) {
      if (iso >= events.ramadanStart && iso <= events.ramadanEnd) {
        holidayName = lang === "ar" ? "ÿ±ŸÖÿ∂ÿßŸÜ" : "Ramadan";
        holidayClass = "ramadan-tag";
      } else if (iso === events.eidFitr) {
        holidayName = lang === "ar" ? "ÿπŸäÿØ ÿßŸÑŸÅÿ∑ÿ±" : "Eid Al-Fitr";
        holidayClass = "eid-tag";
      } else if (iso === events.arafah) {
        holidayName = lang === "ar" ? "ÿπÿ±ŸÅÿ©" : "Arafah";
        holidayClass = "eid-tag";
      } else if (iso === events.eidAdha) {
        holidayName = lang === "ar" ? "ÿπŸäÿØ ÿßŸÑÿ£ÿ∂ÿ≠Ÿâ" : "Eid Al-Adha";
        holidayClass = "eid-tag";
      }
    }

    const row = document.createElement("div");
    row.className = "row";
    if (date.getTime() === today.getTime()) row.classList.add("today-row");

    // Create Date Cell
    let tagHTML = holidayName ? `<div class="holiday-tag ${holidayClass}">${holidayName}</div>` : "";
    
    row.innerHTML = `
      <div class="date-cell">
        <span>${d}</span>
        <span class="day-name">${days[lang][date.getDay()]}</span>
        ${tagHTML}
      </div>
    `;

    // Shift Columns
    const diff = Math.floor((date - referenceDate) / 86400000);
    for (let g = 0; g < 5; g++) {
      // Hide logic
      const hidden = (selected !== -1 && selected !== g) ? "col-hidden" : "";
      
      const idx = ((diff + g + 5) % 5 + 5) % 5; // Safe modulo
      const code = shiftCodes[idx];
      const shiftName = shiftNames[lang][code];

      const cell = document.createElement("div");
      cell.className = `shift-cell ${code} ${hidden}`;
      cell.innerText = shiftName;
      
      row.appendChild(cell);
    }
    calBody.appendChild(row);
  }
}

/* ---------- INITIALIZATION ---------- */
// 1. Apply Dark Mode Class
if (dark) {
  document.body.classList.add("dark");
}

// 2. Set Initial Top Bar Color (NEW)
updateThemeColor(dark);

// 3. Render Calendar
render();

</script>
</body>
</html>
